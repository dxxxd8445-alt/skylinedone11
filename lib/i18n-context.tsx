"use client";

import React, { createContext, useContext, useEffect, useMemo, useState } from "react";

export type SupportedLanguage =
  | "en"
  | "es"
  | "fr"
  | "de"
  | "it"
  | "pt"
  | "nl"
  | "pl"
  | "tr"
  | "ru"
  | "ar"
  | "hi"
  | "ja"
  | "ko"
  | "zh";

type I18nContextValue = {
  language: SupportedLanguage;
  setLanguage: (l: SupportedLanguage) => void;
  locale: string;
  t: (key: string) => string;
};

const I18nContext = createContext<I18nContextValue | null>(null);

const STORAGE_KEY = "magma_language";

const languageToLocale: Record<SupportedLanguage, string> = {
  en: "en-US",
  es: "es-ES",
  fr: "fr-FR",
  de: "de-DE",
  it: "it-IT",
  pt: "pt-PT",
  nl: "nl-NL",
  pl: "pl-PL",
  tr: "tr-TR",
  ru: "ru-RU",
  ar: "ar",
  hi: "hi-IN",
  ja: "ja-JP",
  ko: "ko-KR",
  zh: "zh-CN",
};

const translations: Record<SupportedLanguage, Record<string, string>> = {
  en: {
    nav_store: "STORE",
    nav_status: "STATUS",
    nav_guides: "GUIDES",
    nav_reviews: "REVIEWS",
    nav_support: "SUPPORT",
    search_placeholder: "Search for products..",
    cart: "Cart",
    no_products_found: "No products found",
    from: "From",
    starting_at: "Starting at",
    buy_now: "Buy Now",
    your_cart: "Your Cart",
    cart_empty: "Your cart is empty",
    subtotal: "Subtotal",
    review_checkout: "Review & Checkout",
    browse_by_category: "Browse by category — click a game to view its products",
    swipe_to_browse: "Swipe to browse",
    product: "product",
    products: "products",
    in_this_category: "in this category",
    most_popular: "Most Popular",
    safest: "Safest",
    back_to_all_games: "Back to All Games",
    undetected_working: "UNDETECTED (WORKING)",
    maintenance: "MAINTENANCE",
    view_details: "View Details",
    no_products_yet: "No products yet",
    add_products_admin: "Add products in the admin to see them here",
    back_to_store: "Back to store",
  },
  es: {
    nav_store: "TIENDA",
    nav_status: "ESTADO",
    nav_guides: "GUÍAS",
    nav_reviews: "RESEÑAS",
    nav_support: "SOPORTE",
    search_placeholder: "Buscar productos..",
    cart: "Carrito",
    no_products_found: "No se encontraron productos",
    from: "Desde",
    starting_at: "Desde",
    buy_now: "Comprar",
    your_cart: "Carrito",
    cart_empty: "Tu carrito está vacío",
    subtotal: "Subtotal",
    review_checkout: "Revisar y pagar",
    browse_by_category: "Explorar por categoría — haz clic en un juego para ver sus productos",
    swipe_to_browse: "Desliza para explorar",
    product: "producto",
    products: "productos",
    in_this_category: "en esta categoría",
    most_popular: "Más popular",
    safest: "Más seguro",
    back_to_all_games: "Volver a todos los juegos",
    undetected_working: "SIN DETECCIÓN (FUNCIONA)",
    maintenance: "MANTENIMIENTO",
    view_details: "Ver detalles",
    no_products_yet: "Aún no hay productos",
    add_products_admin: "Agrega productos en el admin para verlos aquí",
    back_to_store: "Volver a la tienda",
  },
  fr: {
    nav_store: "BOUTIQUE",
    nav_status: "STATUT",
    nav_guides: "GUIDES",
    nav_reviews: "AVIS",
    nav_support: "SUPPORT",
    search_placeholder: "Rechercher des produits..",
    cart: "Panier",
    no_products_found: "Aucun produit trouvé",
    from: "À partir de",
    starting_at: "À partir de",
    buy_now: "Acheter",
    your_cart: "Panier",
    cart_empty: "Votre panier est vide",
    subtotal: "Sous-total",
    review_checkout: "Vérifier & payer",
    browse_by_category: "Parcourir par catégorie — cliquez sur un jeu pour voir ses produits",
    swipe_to_browse: "Balayez pour parcourir",
    product: "produit",
    products: "produits",
    in_this_category: "dans cette catégorie",
    most_popular: "Le plus populaire",
    safest: "Le plus sûr",
    back_to_all_games: "Retour à tous les jeux",
    undetected_working: "INDETECTABLE (ACTIF)",
    maintenance: "MAINTENANCE",
    view_details: "Voir les détails",
    no_products_yet: "Aucun produit",
    add_products_admin: "Ajoutez des produits dans l’admin pour les voir ici",
    back_to_store: "Retour à la boutique",
  },
  de: {
    nav_store: "SHOP",
    nav_status: "STATUS",
    nav_guides: "GUIDES",
    nav_reviews: "BEWERTUNGEN",
    nav_support: "SUPPORT",
    search_placeholder: "Produkte suchen..",
    cart: "Warenkorb",
    no_products_found: "Keine Produkte gefunden",
    from: "Ab",
    starting_at: "Ab",
    buy_now: "Kaufen",
    your_cart: "Warenkorb",
    cart_empty: "Dein Warenkorb ist leer",
    subtotal: "Zwischensumme",
    review_checkout: "Prüfen & bezahlen",
    browse_by_category: "Nach Kategorie durchsuchen — klicke auf ein Spiel, um Produkte zu sehen",
    swipe_to_browse: "Zum Durchsuchen wischen",
    product: "Produkt",
    products: "Produkte",
    in_this_category: "in dieser Kategorie",
    most_popular: "Am beliebtesten",
    safest: "Am sichersten",
    back_to_all_games: "Zurück zu allen Spielen",
    undetected_working: "UNDETECTED (AKTIV)",
    maintenance: "WARTUNG",
  },
  it: {
    nav_store: "NEGOZIO",
    nav_status: "STATO",
    nav_guides: "GUIDE",
    nav_reviews: "RECENSIONI",
    nav_support: "SUPPORTO",
    search_placeholder: "Cerca prodotti..",
    cart: "Carrello",
    no_products_found: "Nessun prodotto trovato",
    from: "Da",
    starting_at: "Da",
    buy_now: "Acquista",
    your_cart: "Carrello",
    cart_empty: "Il tuo carrello è vuoto",
    subtotal: "Subtotale",
    review_checkout: "Rivedi e paga",
    browse_by_category: "Sfoglia per categoria — clicca su un gioco per vedere i prodotti",
    swipe_to_browse: "Scorri per sfogliare",
    product: "prodotto",
    products: "prodotti",
    in_this_category: "in questa categoria",
    most_popular: "Più popolare",
    safest: "Più sicuro",
    back_to_all_games: "Torna a tutti i giochi",
    undetected_working: "NON RILEVATO (ATTIVO)",
    maintenance: "MANUTENZIONE",
  },
  pt: {
    nav_store: "LOJA",
    nav_status: "STATUS",
    nav_guides: "GUIAS",
    nav_reviews: "AVALIAÇÕES",
    nav_support: "SUPORTE",
    search_placeholder: "Pesquisar produtos..",
    cart: "Carrinho",
    no_products_found: "Nenhum produto encontrado",
    from: "A partir de",
    starting_at: "A partir de",
    buy_now: "Comprar",
    your_cart: "Carrinho",
    cart_empty: "Seu carrinho está vazio",
    subtotal: "Subtotal",
    review_checkout: "Revisar e pagar",
    browse_by_category: "Navegar por categoria — clique em um jogo para ver os produtos",
    swipe_to_browse: "Deslize para navegar",
    product: "produto",
    products: "produtos",
    in_this_category: "nesta categoria",
    most_popular: "Mais popular",
    safest: "Mais seguro",
    back_to_all_games: "Voltar para todos os jogos",
    undetected_working: "INDETECTÁVEL (ATIVO)",
    maintenance: "MANUTENÇÃO",
  },
  nl: {
    nav_store: "WINKEL",
    nav_status: "STATUS",
    nav_guides: "GIDSEN",
    nav_reviews: "REVIEWS",
    nav_support: "SUPPORT",
    search_placeholder: "Zoek producten..",
    cart: "Winkelwagen",
    no_products_found: "Geen producten gevonden",
    from: "Vanaf",
    starting_at: "Vanaf",
    buy_now: "Kopen",
    your_cart: "Winkelwagen",
    cart_empty: "Je winkelwagen is leeg",
    subtotal: "Subtotaal",
    review_checkout: "Controleren & afrekenen",
    browse_by_category: "Blader op categorie — klik op een game om producten te bekijken",
    swipe_to_browse: "Veeg om te bladeren",
    product: "product",
    products: "producten",
    in_this_category: "in deze categorie",
    most_popular: "Meest populair",
    safest: "Veiligst",
    back_to_all_games: "Terug naar alle games",
    undetected_working: "UNDETECTED (WERKT)",
    maintenance: "ONDERHOUD",
  },
  pl: {
    nav_store: "SKLEP",
    nav_status: "STATUS",
    nav_guides: "PORADNIKI",
    nav_reviews: "OPINIE",
    nav_support: "WSPARCIE",
    search_placeholder: "Szukaj produktów..",
    cart: "Koszyk",
    no_products_found: "Nie znaleziono produktów",
    from: "Od",
    starting_at: "Od",
    buy_now: "Kup teraz",
    your_cart: "Koszyk",
    cart_empty: "Twój koszyk jest pusty",
    subtotal: "Suma częściowa",
    review_checkout: "Podgląd i płatność",
    browse_by_category: "Przeglądaj kategorie — kliknij grę, aby zobaczyć produkty",
    swipe_to_browse: "Przesuń, aby przeglądać",
    product: "produkt",
    products: "produkty",
    in_this_category: "w tej kategorii",
    most_popular: "Najpopularniejsze",
    safest: "Najbezpieczniejsze",
    back_to_all_games: "Wróć do wszystkich gier",
    undetected_working: "UNDETECTED (DZIAŁA)",
    maintenance: "KONSERWACJA",
  },
  tr: {
    nav_store: "MAĞAZA",
    nav_status: "DURUM",
    nav_guides: "REHBERLER",
    nav_reviews: "YORUMLAR",
    nav_support: "DESTEK",
    search_placeholder: "Ürün ara..",
    cart: "Sepet",
    no_products_found: "Ürün bulunamadı",
    from: "Başlangıç",
    starting_at: "Başlangıç",
    buy_now: "Satın al",
    your_cart: "Sepet",
    cart_empty: "Sepetiniz boş",
    subtotal: "Ara toplam",
    review_checkout: "İncele ve öde",
    browse_by_category: "Kategoriye göre gözat — ürünleri görmek için oyuna tıkla",
    swipe_to_browse: "Gözatmak için kaydır",
    product: "ürün",
    products: "ürün",
    in_this_category: "bu kategoride",
    most_popular: "En popüler",
    safest: "En güvenli",
    back_to_all_games: "Tüm oyunlara dön",
    undetected_working: "TESPİT YOK (AKTİF)",
    maintenance: "BAKIM",
  },
  ru: {
    nav_store: "МАГАЗИН",
    nav_status: "СТАТУС",
    nav_guides: "ГАЙДЫ",
    nav_reviews: "ОТЗЫВЫ",
    nav_support: "ПОДДЕРЖКА",
    search_placeholder: "Поиск товаров..",
    cart: "Корзина",
    no_products_found: "Товары не найдены",
    from: "От",
    starting_at: "От",
    buy_now: "Купить",
    your_cart: "Корзина",
    cart_empty: "Корзина пуста",
    subtotal: "Промежуточный итог",
    review_checkout: "Проверить и оплатить",
    browse_by_category: "Категории — нажмите на игру, чтобы увидеть товары",
    swipe_to_browse: "Проведите, чтобы листать",
    product: "товар",
    products: "товаров",
    in_this_category: "в этой категории",
    most_popular: "Самый популярный",
    safest: "Самый безопасный",
    back_to_all_games: "Назад ко всем играм",
    undetected_working: "UNDETECTED (РАБОТАЕТ)",
    maintenance: "ОБСЛУЖИВАНИЕ",
  },
  ar: {
    nav_store: "المتجر",
    nav_status: "الحالة",
    nav_guides: "الأدلة",
    nav_reviews: "المراجعات",
    nav_support: "الدعم",
    search_placeholder: "ابحث عن المنتجات..",
    cart: "السلة",
    no_products_found: "لم يتم العثور على منتجات",
    from: "من",
    starting_at: "يبدأ من",
    buy_now: "اشترِ الآن",
    your_cart: "سلتك",
    cart_empty: "سلتك فارغة",
    subtotal: "المجموع الفرعي",
    review_checkout: "مراجعة والدفع",
    browse_by_category: "تصفح حسب الفئة — انقر على لعبة لعرض منتجاتها",
    swipe_to_browse: "اسحب للتصفح",
    product: "منتج",
    products: "منتجات",
    in_this_category: "في هذه الفئة",
    most_popular: "الأكثر شعبية",
    safest: "الأكثر أمانًا",
    back_to_all_games: "العودة لكل الألعاب",
    undetected_working: "غير مكتشف (يعمل)",
    maintenance: "صيانة",
  },
  hi: {
    nav_store: "स्टोर",
    nav_status: "स्थिति",
    nav_guides: "गाइड",
    nav_reviews: "रिव्यू",
    nav_support: "सपोर्ट",
    search_placeholder: "प्रोडक्ट खोजें..",
    cart: "कार्ट",
    no_products_found: "कोई प्रोडक्ट नहीं मिला",
    from: "से",
    starting_at: "से शुरू",
    buy_now: "खरीदें",
    your_cart: "कार्ट",
    cart_empty: "आपका कार्ट खाली है",
    subtotal: "उप-योग",
    review_checkout: "रिव्यू और चेकआउट",
    browse_by_category: "कैटेगरी के अनुसार देखें — गेम पर क्लिक करें",
    swipe_to_browse: "ब्राउज़ करने के लिए स्वाइप करें",
    product: "प्रोडक्ट",
    products: "प्रोडक्ट्स",
    in_this_category: "इस कैटेगरी में",
    most_popular: "सबसे लोकप्रिय",
    safest: "सबसे सुरक्षित",
    back_to_all_games: "सभी गेम्स पर वापस",
    undetected_working: "अनडिटेक्टेड (वर्किंग)",
    maintenance: "मेंटेनेंस",
  },
  ja: {
    nav_store: "ストア",
    nav_status: "ステータス",
    nav_guides: "ガイド",
    nav_reviews: "レビュー",
    nav_support: "サポート",
    search_placeholder: "商品を検索..",
    cart: "カート",
    no_products_found: "商品が見つかりません",
    from: "から",
    starting_at: "から",
    buy_now: "購入",
    your_cart: "カート",
    cart_empty: "カートは空です",
    subtotal: "小計",
    review_checkout: "確認して購入",
    browse_by_category: "カテゴリ別 — ゲームをクリックして表示",
    swipe_to_browse: "スワイプして閲覧",
    product: "商品",
    products: "商品",
    in_this_category: "このカテゴリ内",
    most_popular: "人気",
    safest: "安全",
    back_to_all_games: "すべてのゲームへ戻る",
    undetected_working: "未検出 (稼働)",
    maintenance: "メンテナンス",
  },
  ko: {
    nav_store: "스토어",
    nav_status: "상태",
    nav_guides: "가이드",
    nav_reviews: "리뷰",
    nav_support: "지원",
    search_placeholder: "상품 검색..",
    cart: "장바구니",
    no_products_found: "상품을 찾을 수 없습니다",
    from: "부터",
    starting_at: "부터",
    buy_now: "구매",
    your_cart: "장바구니",
    cart_empty: "장바구니가 비었습니다",
    subtotal: "소계",
    review_checkout: "검토 및 결제",
    browse_by_category: "카테고리별 보기 — 게임을 눌러 제품 보기",
    swipe_to_browse: "스와이프하여 탐색",
    product: "상품",
    products: "상품",
    in_this_category: "이 카테고리에서",
    most_popular: "인기",
    safest: "안전",
    back_to_all_games: "모든 게임으로 돌아가기",
    undetected_working: "UNDETECTED (작동)",
    maintenance: "점검",
  },
  zh: {
    nav_store: "商店",
    nav_status: "状态",
    nav_guides: "指南",
    nav_reviews: "评价",
    nav_support: "支持",
    search_placeholder: "搜索产品..",
    cart: "购物车",
    no_products_found: "未找到产品",
    from: "起",
    starting_at: "起",
    buy_now: "立即购买",
    your_cart: "购物车",
    cart_empty: "购物车为空",
    subtotal: "小计",
    review_checkout: "查看并结账",
    browse_by_category: "按类别浏览 — 点击游戏查看产品",
    swipe_to_browse: "滑动浏览",
    product: "产品",
    products: "产品",
    in_this_category: "在此类别",
    most_popular: "最受欢迎",
    safest: "最安全",
    back_to_all_games: "返回所有游戏",
    undetected_working: "未检测 (可用)",
    maintenance: "维护",
  },
};

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [language, setLanguageState] = useState<SupportedLanguage>("en");
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
    try {
      const raw = window.localStorage.getItem(STORAGE_KEY);
      if (raw) setLanguageState(raw as SupportedLanguage);
    } catch {
    }
  }, []);

  const setLanguage = (l: SupportedLanguage) => {
    setLanguageState(l);
    if (mounted) {
      try {
        window.localStorage.setItem(STORAGE_KEY, l);
      } catch {
      }
    }
  };

  const locale = languageToLocale[language] || "en-US";

  const t = (key: string) => {
    const dict = translations[language] || translations.en;
    return dict[key] || translations.en[key] || key;
  };

  const value = useMemo(() => ({ language, setLanguage, locale, t }), [language, locale]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error("useI18n must be used within I18nProvider");
  return ctx;
}
